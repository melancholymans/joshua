#include <memory>
#include <array>	//generate_evasions TESTのため

#include "types.h"
#include "common.h"
//名前空間使用宣言
using Movens::string_from_move;
using Positionns::print_board;
/*
NonCapture,			//駒を取らない手
Capture,			//駒を取る手
CapturePlusPro,		//Capture+歩香桂飛角（金銀王以外）で取る手＋取らずに成る手(aperyはここのコメントとプログラムの定義が異なる）
NonCaptureMinusPro,	//NonCapture-歩香桂飛角を取らない成る手-香の３段目への駒をとらない不成(移動不可の打ち駒は禁じ手ではあるがそれ以上移動不可能な進む手は禁じ手と明示してある資料がない）
*/

#ifdef _DEBUG
//TESTのためのヘルパー関数
static bool array_check(Move anser, MoveStack *m)
{
	for (int i=0; i < 512; i++){
		if (m++->move == anser){
			return true;
		}
	}
	return false;
}
//ms[512]を直前にゼロクリアすることを利用してどれくらい
//データを積み上げたかカウントアップする。
static int array_count(MoveStack *m)
{
	int count = 0;
	for (int i = 0; i < 512; i++){
		if (m++->move == 0){
			return count;
		}
		count++;
	}
	return count;
}
TEST(movegen, generate_evasions_POS39_white)
{
	//問題局面=受けとしのぎNo39
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("1g3l2l/2+B6/k2p5/2pP3p1/1p1g1p1n1/N1s1psPNp/6pP1/R2+n1P1K1/5SG1L b Brgsl6p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(A4, B6, 0, Night, EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(21, array_count(ms));
	//move
	ans = make_move(A7, B6, 0, King, Night);
	EXPECT_TRUE(array_check(ans, ms));
	//drop
	ans = make_move(Square(Rook + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS37_black)
{
	//問題局面=受けとしのぎNo37
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("7nl/2g2Gsk1/+P3pPpp1/2pp4P/1p2PpSN1/2PS3P1/1P2+p4/K1b6/LRB5L w GSN3Prgnl 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(Square(Lance + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(10, array_count(ms));
	//move
	ans = make_move(A2, B2, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C1, A3, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//drop
	ans = make_move(Square(Gold + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS35_white)
{
	//問題局面=受けとしのぎNo35
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("l3gB1nl/7kp/4PP3/2p2ps1P/3ps1P1+R/pPP2GN2/2N3N2/P2+p+p4/LKG6 b S3Prbgslp 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(I5, H6, 0, Dragon, EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(8, array_count(ms));
	//move
	ans = make_move(H8, G9, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G6, H7, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//drop
	ans = make_move(Square(Rook + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS33_black)
{
	//問題局面=受けとしのぎNo33
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("1n4kn1/4+S1g1G/l3G1p1l/p4psp1/4P3p/Pp1PS1P2/4b4/1PKp1+r3/LN6L w BGSN2Pr4p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(Square(Rook + SquareNum - 1), C4, 0, PieceType(0), EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(7+1, array_count(ms));	//TODO:King C2-C1は非合法手であるが現時点で検出できないので放置
	//move
	ans = make_move(C2, D3, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B1, C3, 0, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//drop
	ans = make_move(Square(Bishop + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS31_white)
{
	//問題局面=受けとしのぎNo31
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("l5k2/4p1l2/4g4/p2p2p+Bp/2P2R1p1/1np+b2P1P/PP1+rP2+n1/2G4P1/LNK1G4 b 2S2Pg2snl2p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(H6, I7, 0, Horse, EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(6, array_count(ms));
	//move
	ans = make_move(G9, H9, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D4, H8, 0, Horse, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//drop
	ans = make_move(Square(Gold + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS29_black)
{
	//問題局面=受けとしのぎNo29
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("4+R1sn1/4G1kp+P/2P2g2l/2p2bpS1/pPsPPp1Pp/3p+r1P2/NS1g2B2/PK7/L1L5L w GNPn2p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(E4, E2, 0, Dragon, EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(7, array_count(ms));
	//move
	ans = make_move(B2, B1, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B3, C2, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C1, C2, 0, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	ans = make_move(Square(Gold + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS27_white)
{
	//問題局面=受けとしのぎNo27　
	//本来black局面であるが手番反転してwhite側手番でテストしている
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("l4G1n1/6pkl/6s1p/2p1p4/pp1PbpN2/2Sp2s1P/PPP6/1KGg5/LN2+r3L b RS3Pbgn2p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(Square(Rook + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(15, array_count(ms));
	//move
	ans = make_move(H8, I9, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, H6, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G4, H5, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	ans = make_move(Square(Bishop + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night+ SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS25_black)
{
	//問題局面=受けとしのぎNo25　D5->C4竜移動前の局面を現している
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("6snl/+P4gk2/4+P1p2/1P3+B1P1/BN1+rp1Npp/p2P1PP2/4Rp3/N1K2g3/L1s5L w G2SL2Pg3p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(D5, C4, 0, Dragon, EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(8+1, array_count(ms));	//TODO:King C2->C1は非合法手であるが検出する仕組みがないので放置
	ans = make_move(C2, B1, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C2, D1, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A5, C3, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, C3, 0, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	ans = make_move(Square(Gold + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS23_white)
{
	//問題局面=受けとしのぎNo23　91飛車を打つ前の局面を現している
	//本来black局面であるが手番反転してwhite側手番でテストしている

	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("l6n1/6+P+L1/2np1p3/p3psS2/1pPPP1P1g/2GS1+B1pk/PKN+r1P3/3+p5/L4+s3 b RGbgnl4p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;
	
	pos.do_move(make_move(Square(Rook + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(10, array_count(ms));
	ans = make_move(I4, H3, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//drop 
	ans = make_move(Square(Bishop + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, generate_evasions_POS21_black)
{
	/*問題局面=受けとしのぎNo21　66角を打つ前の局面を現している*/
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("5+Prnl/4+R4/1p1p2gkp/P1pl1p1p1/1N4pPP/p1P4G1/4P1N2/4G4/K3S3L w BGSNLPb2s3p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	using std::array;
	array<StateInfo, 80> st_stack;		//stack代わりのメモリ
	int index = 0;

	pos.do_move(make_move(Square(Bishop + SquareNum - 1), D4, 0, PieceType(0), EmptyPiece), st_stack[index]);
	ml = generate_moves<Evasion>(ml, pos);
	EXPECT_EQ(13, array_count(ms));
	ans = make_move(A1, A2, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A1, B1, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A1, B2, 0, King, EmptyPiece);
	EXPECT_FALSE(array_check(ans, ms));	//them側駒の利きに逃げるのは非合法
	//TODO:ここでは全ても駒に対して、全ての位置に対して合いごまを生成しているが、柿木将棋のように合いごま対策をすること
	ans = make_move(Square(Pawn + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, movegen_POS3_white)
{
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("2+s2g3/1G3g3/2+L1+Np1K1/6p1+n/2GS1+PP1+S/1pPpp4/+PPkPP1+l1+p/1+b1+r+P4/2+P6 w RBSNLPnl2p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;

	//NonCapture ALL=false
	ml = generate_moves<NonCapture>(ml, pos);
	EXPECT_EQ(33, array_count(ms));
	//pawn 1
	ans = make_move(F7, F6, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 7
	ans = make_move(F8, G7, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F8, G8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F8, E8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, G8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, E8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, G9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, E9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProPawn 4
	ans = make_move(I3, I2, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I3, H2, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I3, H3, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I3, I4, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProLamce 6
	ans = make_move(G3, H3, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G3, H2, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G3, G4, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G3, G2, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G3, F3, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G3, F2, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProNight 3
	ans = make_move(I6, H5, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I6, I7, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I6, H6, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProSilver 4
	ans = make_move(C9, D9, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C9, D8, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C9, C8, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C9, B9, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Horse 4
	ans = make_move(B2, C2, 0, Horse, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B2, B1, 0, Horse, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B2, A1, 0, Horse, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B2, A2, 0, Horse, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Dragon 3
	ans = make_move(D2, E1, 0, Dragon, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D2, D1, 0, Dragon, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D2, C2, 0, Dragon, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//king 1
	ans = make_move(C3, C2, 0, King, EmptyPiece);	//本当は合法手ではない王の移動にthem駒の利き範囲への移動をロックする実装がまだないため
	EXPECT_TRUE(array_check(ans, ms));
	//Capture ALL=false
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Capture>(ml, pos);
	EXPECT_EQ(18, array_count(ms));
	//pawn 5
	ans = make_move(G6, G5, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E4, E3, 1, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D4, D3, 1, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B3, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B3, 1, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 1
	ans = make_move(F8, E7, 0, Gold, ProNight);
	EXPECT_TRUE(array_check(ans, ms));
	//king 3
	ans = make_move(C3, C4, 0, King, Pawn);	//本当は合法手ではない、王手の移動に相手利きがあるところに移動しない機能が実装されていないため
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C3, B3, 0, King, Pawn);	//本当は合法手ではない、王手の移動に相手利きがあるところに移動しない機能が実装されていないため
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C3, D3, 0, King, Pawn);	//本当は合法手ではない、王手の移動に相手利きがあるところに移動しない機能が実装されていないため
	EXPECT_TRUE(array_check(ans, ms));
	//ProNight 1
	ans = make_move(I6, I5, 0, ProNight, ProSilver);
	EXPECT_TRUE(array_check(ans, ms));
	//ProSilver 1
	ans = make_move(C9, B8, 0, ProSilver, Gold);
	EXPECT_TRUE(array_check(ans, ms));
	//Horse 3
	ans = make_move(B2, B3, 0, Horse, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B2, A3, 0, Horse, ProPawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B2, C1, 0, Horse, ProPawn);
	EXPECT_TRUE(array_check(ans, ms));
	//Dragon 4
	ans = make_move(D2, E2, 0, Dragon, ProPawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D2, C1, 0, Dragon, ProPawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D2, D3, 0, Dragon, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D2, E3, 0, Dragon, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Drop>(ml, pos);
	EXPECT_EQ(102, array_count(ms));
	//pawn 22
	ans = make_move(Square(Pawn + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Lance 43
	ans = make_move(Square(Lance + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Night 37
	ans = make_move(Square(Night + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, movegen_POS3_black)
{
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("2+s2g3/1G3g3/2+L1+Np1K1/6p1+n/2GS1+PP1+S/1pPpp4/+PPkPP1+l1+p/1+b1+r+P4/2+P6 b RBSNLPnl2p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;

	//NonCapture ALL=false
	ml = generate_moves<NonCapture>(ml, pos);
	EXPECT_EQ(42, array_count(ms));
	//Silver 3
	ans = make_move(D5, C6, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D5, D6, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D5, E6, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 9
	ans = make_move(C5, B5, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C5, B6, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C5, C6, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C5, D6, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, B7, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, A8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, A9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, B9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, C8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//king 6
	ans = make_move(H7, I8, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H7, I7, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H7, H8, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H7, H6, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H7, G8, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H7, G7, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProPawn 12
	ans = make_move(A3, A4, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A3, A2, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C1, C2, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C1, B1, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C1, D1, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E2, F3, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E2, F2, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E2, E1, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F5, E6, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F5, E5, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F5, F4, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F5, F6, 0, ProPawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProLance 5
	ans = make_move(C7, C8, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, D8, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, D7, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, B7, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, C6, 0, ProLance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProNight 4
	ans = make_move(E7, D8, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E7, E8, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E7, D7, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E7, E6, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//ProSilver 3
	ans = make_move(I5, H5, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I5, I4, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I5, H6, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));

	//Capture ALL=false
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Capture>(ml, pos);
	EXPECT_EQ(16, array_count(ms));
	//8
	ans = make_move(B3, B4, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D3, D4, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, E4, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G5, G6, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D5, E4, 0, Silver, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, C9, 0, Gold, ProSilver);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H7, G6, 0, King, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H7, I6, 0, King, ProNight);
	EXPECT_TRUE(array_check(ans, ms));
	//ProPawn 5
	ans = make_move(A3, B4, 0, ProPawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C1, B2, 0, ProPawn, Horse);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C1, D2, 0, ProPawn, Dragon);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E2, D2, 0, ProPawn, Dragon);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F5, G6, 0, ProPawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//PRoNight 2
	ans = make_move(E7, F8, 0, ProNight, Gold);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E7, F7, 0, ProNight, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//ProSilver 1
	ans = make_move(I5, I6, 0, ProSilver, ProNight);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Drop>(ml, pos);
	EXPECT_EQ(258, array_count(ms));
	//pawn 24
	ans = make_move(Square(Pawn + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//lance 44
	ans = make_move(Square(Lance + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Night 37
	ans = make_move(Square(Night + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Silver 51
	ans = make_move(Square(Silver + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Bishop 51
	ans = make_move(Square(Bishop + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Rook 51
	ans = make_move(Square(Rook + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, movegen_POS2_white)
{
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("2s2g3/1G3g3/2L1Np2l/2ps2pKn/2G2PPPS/PpPpp4/1PkPP3p/9/9 w RBSNLPrbnl2p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;

	//NonCapture ALL=false
	ml = generate_moves<NonCapture>(ml, pos);
	EXPECT_EQ(17, array_count(ms));
	//pawn 2
	ans = make_move(I3, I2, 1, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F7, F6, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//night 1
	ans = make_move(I6, H4, 0, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//silver 4
	ans = make_move(D6, E5, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D6, D5, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C9, D8, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C9, C8, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 6
	ans = make_move(F8, G8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F8, E8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, G8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, E8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, G9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F9, E9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//king 3
	ans = make_move(C3, D2, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C3, C2, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C3, B2, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Capture ALL=false
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Capture>(ml, pos);
	EXPECT_EQ(14, array_count(ms));
	//pawn 5
	ans = make_move(G6, G5, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E4, E3, 1, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D4, D3, 1, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C6, C5, 0, Pawn, Gold);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B3, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B3, 1, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//silver 4
	ans = make_move(C9, B8, 0, Silver, Gold);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D6, C5, 0, Silver, Gold);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D6, C7, 0, Silver, Lance);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D6, E7, 0, Silver, Night);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 1
	ans = make_move(F8, E7, 0, Gold, Night);
	EXPECT_TRUE(array_check(ans, ms));
	//king 3
	ans = make_move(C3, D3, 0, King, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C3, B3, 0, King, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C3, C4, 0, King, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Drop>(ml, pos);
	EXPECT_EQ(198, array_count(ms));
	//pawn  13
	ans = make_move(Square(Pawn + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//lance 44
	ans = make_move(Square(Lance + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Night 35
	ans = make_move(Square(Night + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Bishop 53
	ans = make_move(Square(Bishop + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Rook 53
	ans = make_move(Square(Rook + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, movegen_POS2_black)
{
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("2s2g3/1G3g3/2L1Np2l/2ps2pKn/2G2PPPS/PpPpp4/1PkPP3p/9/9 b RBSNLPrbnl2p 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;

	//NonCapture ALL=false
	ml = generate_moves<NonCapture>(ml, pos);
	EXPECT_EQ(16, array_count(ms));
	//pawn 2
	ans = make_move(F5, F6, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A4, A5, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//lance 2
	ans = make_move(C7, C8, 1, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, C8, 0, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//night 1
	ans = make_move(E7, D9, 1, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//silver 1
	ans = make_move(I5, H4, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 8
	ans = make_move(C5, B6, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C5, B5, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C5, D5, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, A9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, B9, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, A8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, C8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, B7, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//king 2
	ans = make_move(H6, H7, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H6, G7, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Capture ALL=false
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Capture>(ml, pos);
	EXPECT_EQ(13, array_count(ms));
	//pawn 4
	ans = make_move(B3, B4, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D3, D4, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, E4, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G5, G6, 0, Pawn, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//lance 1
	ans = make_move(C7, C9, 1, Lance, Silver);
	EXPECT_TRUE(array_check(ans, ms));
	//night 1
	ans = make_move(E7, F9, 1, Night, Gold);
	EXPECT_TRUE(array_check(ans, ms));
	//silver 1
	ans = make_move(I5, I6, 0, Silver, Night);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 3
	ans = make_move(C5, C6, 0, Gold, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C5, D6, 0, Gold, Silver);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B8, C9, 0, Gold, Silver);
	EXPECT_TRUE(array_check(ans, ms));
	//king 3
	ans = make_move(H6, G6, 0, King, Pawn);	
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H6, I6, 0, King, Night);	//本当は合法手ではない
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H6, I7, 0, King, Lance);	
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Drop>(ml, pos);
	EXPECT_EQ(248, array_count(ms));
	//Pawn 4
	ans = make_move(Square(Pawn + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//lance 46
	ans = make_move(Square(Lance + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Lance + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Night 39
	ans = make_move(Square(Night + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Night + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Silver 53
	ans = make_move(Square(Silver + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Bishop 53
	ans = make_move(Square(Bishop + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Bishop + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Rook 53
	ans = make_move(Square(Rook + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), H1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Rook + SquareNum - 1), I1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, movegen_POS1_white)
{
	//問題図は自作
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("4k4/4gP3/pNbp1pB2/4R1ppL/1P5n1/lrP1P1PlP/2p1+nS1P1/5+s2K/7NL w G4P2g2sp 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;
	//NonCapture ALL=false
	ml = generate_moves<NonCapture>(ml, pos);
	EXPECT_EQ(40, array_count(ms));
	ans = make_move(G6, G5, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F7, F6, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(D7, D6, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C3, C2, 1, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A7, A6, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A4, A3, 1, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A4, A3, 0, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A4, A2, 1, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A4, A2, 0, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(A4, A1, 1, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H5, I3, 1, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H5, I3, 0, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H5, G3, 1, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H5, G3, 0, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E8, E7, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E8, D8, 0, Gold, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, E2, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, D3, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, D2, 0, ProNight, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F2, G2, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F2, G1, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F2, F1, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F2, E1, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F2, E2, 0, ProSilver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, D6, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, E5, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, F4, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, G3, 1, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, H2, 1, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, B6, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, A5, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, D8, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, B8, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, A9, 0, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B3, 1, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B2, 1, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B1, 1, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E9, D8, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E9, D9, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E9, F9, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Capture ALL=false
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Capture>(ml, pos);
	EXPECT_EQ(10, array_count(ms));
	ans = make_move(H4, H3, 1, Lance, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H4, H3, 0, Lance, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E8, F8, 0, Gold, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, E4, 0, ProNight, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E3, F3, 0, ProNight, Silver);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F2, F3, 0, ProSilver, Silver);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C7, I1, 1, Bishop, Lance);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, C4, 0, Rook, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B4, B5, 0, Rook, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E9, F8, 0, King, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Drop>(ml, pos);
	EXPECT_EQ(115, array_count(ms));
	//pawn13
	ans = make_move(Square(Pawn + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);	//ここはFALSEなのでPAWN生成数は13
	EXPECT_FALSE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), E7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), B3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), B8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//silver 51
	ans = make_move(Square(Silver + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), F9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), E7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), C9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Silver + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//gold 51
	ans = make_move(Square(Gold + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
TEST(movegen, movegen_POS1_black)
{
	//問題図は自作
	using namespace MoveGeneratens;
	Searcher* sech = new Searcher;
	sech->init();
	string ss("4k4/4gP3/pNbp1pB2/4R1ppL/1P5n1/lrP1P1PlP/2p1+nS1P1/5+s2K/7NL b G4P2g2sp 1");
	Position pos(ss, sech->threads.main_thread(), sech);
	MoveStack ms[512];
	memset(ms, 0, sizeof(ms));
	MoveStack* ml = ms;
	Move ans;

	//TODO:全ての手生成がテストできていない。全ての手が生成できる局面ではないため。別の局面を用意すること
	//Lance,Nightの打つ手、silverの打つ手など
	//NonCapture ALL=false
	ml = generate_moves<NonCapture>(ml, pos);
	EXPECT_EQ(32, array_count(ms));		//32
	ans = make_move(I4, I5, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G4, G5, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F8, F9, 1, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E4 ,E5, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(C4, C5, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B5, B6, 0, Pawn, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I6, I7, 0, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I6, I7, 1, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I6, I8, 0, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I6, I8, 1, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I6, I9, 1, Lance, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));	
	ans = make_move(H1, G3, 0, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(H1, I3, 0, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B7, A9, 1, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(B7, C9, 1, Night, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F3, F4, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F3, E2, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(F3, G2, 0, Silver, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, H8, 1, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, I9, 1, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, F6, 1, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, E5, 1, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, D4, 1, Bishop, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, F6, 0, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, D6, 0, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, C6, 0, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, B6, 0, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, A6, 0, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, E7, 1, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, E5, 0, Rook, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I2, I3, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(I2, H2, 0, King, EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	//Capture ALL=false
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Capture>(ml, pos);
	EXPECT_EQ(5, array_count(ms));
	ans = make_move(H3, H4, 0, Pawn, Lance);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, H6, 1, Bishop, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(G7, C3, 1, Bishop, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, E8, 1, Rook, Gold);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(E6, G6, 0, Rook, Pawn);
	EXPECT_TRUE(array_check(ans, ms));
	//Drop
	memset(ms, 0, sizeof(ms));
	ml = ms;	//初期化
	ml = generate_moves<Drop>(ml, pos);
	EXPECT_EQ(64, array_count(ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), D4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), D3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Pawn + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), I3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), H2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), G1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), F1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E7, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), E1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D4, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), D1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), C1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), B1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A9, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A8, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A6, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A5, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A3, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A2, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	ans = make_move(Square(Gold + SquareNum - 1), A1, 0, PieceType(0), EmptyPiece);
	EXPECT_TRUE(array_check(ans, ms));
	sech->threads.exit();
	delete sech;
}
#endif

